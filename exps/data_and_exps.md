# Data

## Data for detection

**old** </br>
[data]: `train/val=4092/400 images`. `imsize=540x960, 575x1024, 576x1024, 760x1352` </br>
[description]: Ben generated data using Roboflow. The data consists of:
`orig/train/val/test=594/4092/400/188 image`, which they are made from
`orig/train/val/test=594/341/100/47 images`. The train is mosaic, valid and test are crops.
The original image size is `1520x2704`</br>

**data8_v1** </br>
[data]: `train/val=5880/390 images`. `imsizes=1080x1920, 1220x2098`</br>
[description]: Every 8th frame take samples only for F, G every frame. 231_cam_1 used for val.  </br>
[code]: `data_v1.py` </br>
[labels]: zip files in yolo format
[vids]: 04_07_22_F_2_rect_valid, 04_07_22_G_2_rect_valid, 129_cam_1, 129_cam_2, 161_cam_1, 161_cam_2, 183_cam_1, 183_cam_2, 231_cam_1, 231_cam_2, 261_cam_1, 349_cam_1, 349_cam_2, 406_cam_1, 406_cam_2 </br>

**data8_v1_old**</br>
[data]: `train/val=9972/790 images` </br> 
[description]: Combine `data8_v1` and `old` using symbolic links. </br>
[code]: `data_v1_old.sh` </br>


**data8_v2**
[data]: `train/val=6380/484 images`. `imsizes=1080x1920, 1220x2098, 1520x2704` </br>
[description]: Combine `data8_v1` and `orig` old data contains 594 images, where first 94 added to validation and the rest of 500 images to the training set. `imsizes=1080x1920, 1520x2704`</br>
[code]: `data_v2.py` </br>

**data8_v3**
[data]: `train/val=19112/484 images`. `imsizes=1080x1920, 1152x2048, 1190x2048, 1220x2098, 1520x2704` </br>
[description]: training data of `data8_v2` with `6380` images is uploaded in Roboflow and rotation `[-15, 15]` and then mosaic approximatly 3 times more data is generated. The validation is the same as `data8_v2`. </br>
NB. The data is here is copied not symbolic linked.


## Data for association learning

**data_al_v1** </br>
[data]: `train/valid/test=959,354/26,823/26,338 images, which is 75G/2,9G/2,8G of data.`. `imsizes=256x5121`</br>
[description]: validation video: 406_cam_1, test vido: 406_cam_2 and the rest for trianing. <\br>
[code]: `data_al_v1.py` <\br>
NB. Generating data part is slow. I had to do multiprocessing per video. Multiprocessing per image resulted much more speed up.
But it was only done for part of 04_07_22_G_2_rect_valid, which was previously failed.

# Data Statistics

- Code for this statistics generated by `exps/data_stats.py`.

Total number of tracks is `411`. Total number of images is `41,724`. Total number of detections is `682,072`.

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vid</th>
      <th>imsize</th>
      <th>#frames</th>
      <th>fps</th>
      <th>#dets</th>
      <th>#tracks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>04_07_22_F_2_rect_valid</td>
      <td>1220x2098</td>
      <td>600</td>
      <td>30</td>
      <td>26413</td>
      <td>46</td>
    </tr>
    <tr>
      <th>1</th>
      <td>04_07_22_G_2_rect_valid</td>
      <td>1220x2098</td>
      <td>600</td>
      <td>30</td>
      <td>22633</td>
      <td>43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>129_cam_1</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>30201</td>
      <td>15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>129_cam_2</td>
      <td>1080x1920</td>
      <td>3118</td>
      <td>240</td>
      <td>30649</td>
      <td>15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>161_cam_1</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>35693</td>
      <td>21</td>
    </tr>
    <tr>
      <th>5</th>
      <td>161_cam_2</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>38349</td>
      <td>23</td>
    </tr>
    <tr>
      <th>6</th>
      <td>183_cam_1</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>105580</td>
      <td>48</td>
    </tr>
    <tr>
      <th>7</th>
      <td>183_cam_2</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>86160</td>
      <td>47</td>
    </tr>
    <tr>
      <th>8</th>
      <td>231_cam_1</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>68671</td>
      <td>32</td>
    </tr>
    <tr>
      <th>9</th>
      <td>231_cam_2</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>82792</td>
      <td>35</td>
    </tr>
    <tr>
      <th>10</th>
      <td>261_cam_1</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>46718</td>
      <td>47</td>
    </tr>
    <tr>
      <th>11</th>
      <td>349_cam_1</td>
      <td>1080x1920</td>
      <td>3118</td>
      <td>240</td>
      <td>27195</td>
      <td>10</td>
    </tr>
    <tr>
      <th>12</th>
      <td>349_cam_2</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>27453</td>
      <td>9</td>
    </tr>
    <tr>
      <th>13</th>
      <td>406_cam_1</td>
      <td>1080x1920</td>
      <td>3118</td>
      <td>240</td>
      <td>27011</td>
      <td>10</td>
    </tr>
    <tr>
      <th>14</th>
      <td>406_cam_2</td>
      <td>1080x1920</td>
      <td>3117</td>
      <td>240</td>
      <td>26554</td>
      <td>10</td>
    </tr>
  </tbody>
</table>

</br>

**Stats on track length per track**
<details>
<summary>[Click to expand]</summary>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vid</th>
      <th>track_id:track_length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>04_07_22_F_2_rect_valid</td>
      <td>0:600,1:600,2:600,3:600,4:600,5:600,6:600,7:600,8:600,9:600,10:600,11:600,12:600,13:600,14:600,15:600,16:600,17:600,18:600,19:600,20:600,21:254,22:600,23:600,24:600,25:600,26:600,27:310,28:600,29:600,30:600,31:600,32:600,33:600,34:600,35:600,36:600,37:600,38:600,39:600,40:600,41:600,42:600,43:600,44:599,45:50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>04_07_22_G_2_rect_valid</td>
      <td>0:600,1:600,2:600,3:600,4:600,5:164,6:600,7:600,8:600,9:600,10:600,11:600,12:600,13:600,14:213,15:600,16:600,17:600,18:600,19:600,20:600,21:600,22:600,23:600,24:600,25:586,26:600,27:600,28:600,29:600,30:600,31:570,32:600,33:600,34:600,35:600,36:600,37:536,38:443,39:321,40:270,41:164,42:134</td>
    </tr>
    <tr>
      <th>2</th>
      <td>129_cam_1</td>
      <td>0:3117,1:3117,2:316,3:3117,4:3117,5:3117,6:3117,7:3117,8:3117,9:1075,10:1473,11:1101,12:848,13:251,14:201</td>
    </tr>
    <tr>
      <th>3</th>
      <td>129_cam_2</td>
      <td>0:3118,1:3118,2:3118,3:334,4:3118,5:3118,6:3118,7:3118,8:3118,9:1064,10:1509,11:1202,12:844,13:551,14:201</td>
    </tr>
    <tr>
      <th>4</th>
      <td>161_cam_1</td>
      <td>0:3117,1:2791,2:1598,3:3117,4:2719,5:2507,6:2563,7:550,8:3117,9:1833,10:3117,11:3117,12:2077,13:322,14:1080,15:668,16:261,17:423,18:319,19:272,20:125</td>
    </tr>
    <tr>
      <th>5</th>
      <td>161_cam_2</td>
      <td>0:1936,1:1650,2:1666,3:3117,4:810,5:3117,6:2496,7:506,8:3117,9:3117,10:3117,11:1709,12:1733,13:800,14:1548,15:2090,16:937,17:1285,18:837,19:961,20:684,21:665,22:451</td>
    </tr>
    <tr>
      <th>6</th>
      <td>183_cam_1</td>
      <td>0:270,1:2100,2:1500,3:3117,4:3117,5:3117,6:3117,7:3117,8:3117,9:3117,10:3117,11:3117,12:3117,13:3117,14:3117,15:3117,16:3117,17:2070,18:3117,19:3117,20:3117,21:3117,22:3117,23:2565,24:2505,25:1974,26:3117,27:3117,28:1607,29:2666,30:3117,31:3117,32:1320,33:1613,34:1989,35:1947,36:1286,37:1228,38:944,39:804,40:709,41:702,42:688,43:686,44:684,45:682,46:681,47:669</td>
    </tr>
    <tr>
      <th>7</th>
      <td>183_cam_2</td>
      <td>0:2217,1:3117,2:3117,3:3117,4:2047,5:3117,6:3117,7:2013,8:3117,9:3117,10:3117,11:2520,12:2567,13:3117,14:3117,15:3117,16:1917,17:3117,18:3117,19:3117,20:3117,21:1533,22:3117,23:3117,24:1053,25:3117,26:266,27:480,28:270,29:1854,30:1794,31:323,32:1104,33:767,34:714,35:696,36:134,37:683,38:677,39:675,40:674,41:671,42:654,43:516,44:467,45:437,46:331</td>
    </tr>
    <tr>
      <th>8</th>
      <td>231_cam_1</td>
      <td>0:3117,1:3117,2:3117,3:3117,4:3117,5:3117,6:3117,7:3117,8:3117,9:1920,10:1139,11:3117,12:3117,13:3117,14:3117,15:2946,16:1019,17:3057,18:3055,19:296,20:215,21:2782,22:2722,23:2542,24:414,25:2422,26:836,27:1458,28:670,29:425,30:176,31:56</td>
    </tr>
    <tr>
      <th>9</th>
      <td>231_cam_2</td>
      <td>0:3117,1:3117,2:3117,3:3117,4:3117,5:3117,6:3117,7:3117,8:1852,9:776,10:3117,11:3117,12:3117,13:3117,14:3117,15:3117,16:3117,17:1453,18:3117,19:3117,20:3117,21:210,22:3117,23:2924,24:3117,25:3027,26:2769,27:2679,28:2581,29:445,30:210,31:522,32:539,33:404,34:61</td>
    </tr>
    <tr>
      <th>10</th>
      <td>261_cam_1</td>
      <td>0:850,1:1612,2:3117,3:3117,4:2543,5:1240,6:120,7:1030,8:1618,9:120,10:3117,11:2658,12:180,13:377,14:650,15:2950,16:3117,17:1658,18:230,19:1128,20:1685,21:929,22:746,23:171,24:685,25:680,26:644,27:671,28:670,29:661,30:378,31:655,32:654,33:163,34:651,35:647,36:641,37:638,38:629,39:624,40:620,41:490,42:90,43:331,44:231,45:211,46:91</td>
    </tr>
    <tr>
      <th>11</th>
      <td>349_cam_1</td>
      <td>0:1371,1:3118,2:3118,3:3118,4:3118,5:3118,6:3118,7:2918,8:2619,9:1579</td>
    </tr>
    <tr>
      <th>12</th>
      <td>349_cam_2</td>
      <td>0:3117,1:3117,2:3117,3:3117,4:3117,5:3117,6:3117,7:3117,8:2517</td>
    </tr>
    <tr>
      <th>13</th>
      <td>406_cam_1</td>
      <td>0:3118,1:3118,2:3118,3:3118,4:3118,5:3118,6:3118,7:524,8:3118,9:1543</td>
    </tr>
    <tr>
      <th>14</th>
      <td>406_cam_2</td>
      <td>0:3117,1:3117,2:3117,3:3117,4:3117,5:701,6:3117,7:3117,8:3117,9:917</td>
    </tr>
  </tbody>
</table>

</details> </br>

# Experiments

## General on Yolo

- Yolov5 stores the result on code location (dev/yolov5) and Yolov8 on the locations, where job is run.
- To set mosaic augmentation: `augment=True rect=False mosaic=1.0 mixup=0.0 close_mosaic=0`.
  - `rect=True` doesn't let the mosaic to work.
  - mixup together with mosaic generates 8 not 4 images
  - `close_mosaic=10` is default, which says don't use mosaic for last 10 epoch
- don't run two inference jobs at the same time. They are short and overwrite the result.
- rotation applies after mosaic.
- number of workers more than the number of cpus per node slows down the process.

**Examples**:</br>
```bash
yolo detect train data=~/data/data8_v2/data.yaml model=~/exp/runs/detect/bgr25/weights/best.pt imgsz=1920 batch=4 epochs=200 name=bgr cache=true close_mosaic=0 augment=True rect=False mosaic=1.0 mixup=0.0

yolo detect train data=/home/~/data/data8_v1_old/data.yaml model=~/dev/yolov8/ultralytics/models/v8/yolov8s.yaml imgsz=1920 batch=8 epochs=400 name=bgr cache=true close_mosaic=0 augment=True rect=False mosaic=1.0 mixup=0.0

yolo detect predict model=~/exp/runs/detect/bgr27/weights/best.pt source=~/data/89_cam_1.MP4 imgsz=1920 conf=0.3 hide_conf=true line_thickness=1 hide_labels=true save_txt=true save_conf=true save=True
```